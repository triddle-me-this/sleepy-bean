package Shooter.weapons;

import java.awt.Color;
import java.awt.image.BufferedImage;

import Shooter.Main;
import core.basicInterfaces.Drawable;
import core.basicInterfaces.Updateable;
import core.console.Console;
import core.gameObjects.EntityList;
import core.gameObjects.entities.activeEntities.Player;
import core.physics.Point;
import core.physics.Vector;
import graphics.AdvancedGraphics;

public abstract class Weapon implements WeaponInterface{

	Point location;
	//location at which the weapon is pointed.
	Point target;
	
	BufferedImage image;
	//direction the weapon is actually pointing
	double aimAngle;
	//changes WHERE the weapon is held, not what it looks like
	double angleOffset;
	
	//distance held away from the player
	double holdDistance;
	
	//frames required to reload
	int reloadTime;
	int reloadCount;
	boolean fireable;
	
	//sprite offset for this specific weapon.
	int xOffset;
	int yOffset;
	
	public Weapon(int x, int y, BufferedImage image, double holdDistance, int reloadTime, int xOff, int yOff, double angOff){
		
		location = new Point(x, y);
		target = new Point(0,0);
		
		this.image = image;
		
		this.holdDistance = holdDistance;
		this.reloadTime = reloadTime;
		reloadCount = 0;
		
		fireable = true;
		
		xOffset = xOff;
		yOffset = yOff;
		angleOffset = angOff;
	}
	
	public void update(Point location) {
		//update with new location -------------
		this.location = location;
		
		//aim Weapon at the mouse -------------
		Point mouse = Console.getMousePositionInGamePanel();
		int x = mouse.getIntX()/Main.SCALE;
		int y = mouse.getIntY()/Main.SCALE;
		target = new Point(x,y);
		
		aimWeapon(target);
	}
	
	public void aimWeapon(Point target){
		
		//determine aim angle
		aimAngle = Math.toDegrees(location.horAngleBetween(target));
		if (target.getIntX() <= location.getIntX()){
			aimAngle += 180;
		}
		//make all angles between 0, 360 ----------
		while (aimAngle <0){
			aimAngle += 360;
		}
		while (aimAngle > 360){
			aimAngle -= 360;
		}
	}
	
	public Point getOffsetPoint(){
		//Determine the point to draw at--------------
		Vector weaponOffset = location.makeVector(target);
		
		//apply angular offset-------------
		double theta = Math.atan(weaponOffset.getY() / weaponOffset.getX());
		theta += angleOffset;
		
		if (weaponOffset.getX()<0){
			theta -=90;
		}
		
		double newX = Math.cos(theta);
		double newY = Math.sin(theta);
		
		
		Vector finalOffset = new Vector(newX, newY);
		finalOffset.setLength(holdDistance);
		//-----------------------------------
		
		Point drawPoint = new Point(location.getIntX() -image.getWidth()/2, location.getIntY()-image.getWidth()/2);
		drawPoint.move(finalOffset);
		
		//shift to look correct on the player sprite
		drawPoint.moveY(yOffset); //-4
		drawPoint.moveX(xOffset); //1
		
		return drawPoint;
	}
	

	public void draw(AdvancedGraphics pen) {
		
		Point drawPoint = getOffsetPoint();
		
		//flip the image for specific angles
		BufferedImage drawImage = image;
		if (aimAngle > 90 && aimAngle < 270){
			drawImage = (BufferedImage) pen.getMirroredImage(drawImage, false, true);
		}
		
		//keep? test in a sec
		aimAngle = aimAngle - (aimAngle % 10);
		
		
		pen.drawRotatedImage(drawImage, new Point(drawPoint.getIntX(), drawPoint.getIntY()), (int)(aimAngle));
		//debug: -----------------------
		//pen.setColor(Color.RED);
		//pen.drawRect(drawPoint.getIntX(), drawPoint.getIntY(), image.getWidth(), image.getWidth());
	}
}
